<!-- Start Page -->
<div class="flex flex-col w-full h-full p-4 print:hidden">
    <!-- Toolbar -->
    <div
        class="flex flex-col gap-2 mb-4 bg-blue-400 sm:flex-row sm:items-center sm:justify-between"
    >
        <div class="w-full card">
            <p-table
                #dt1
                sortField="id"
                [sortOrder]="-1"
                [value]="datas"
                [columns]="cols"
                [rows]="request.rows"
                [first]="request.first"
                showGridlines
                stripedRows
                [paginator]="true"
                [loading]="loading"
                [rows]="50"
                [scrollable]="true"
                scrollHeight="65vh"
                [(selection)]="selectedDatas"
                selectionMode="checkbox"
                (onRowSelect)="onRowSelect($event)"
                (onRowUnselect)="onRowUnselect($event)"
                (onHeaderCheckboxToggle)="onHeaderToggle($event)"
                dataKey="id"
                [tableStyle]="{ 'min-width': '50rem' }"
                [rowsPerPageOptions]="[50]"
                [totalRecords]="this.total"
                [showCurrentPageReport]="true"
                [lazy]="true"
                (onLazyLoad)="loadLazy($event)"
            >
                <ng-template #caption>
                    <div class="flex items-center justify-between">
                        <div class="flex items-center justify-between">
                            <span class="text-xl font-bold">Data Employee</span>
                        </div>
                        <div class="flex gap-2">
                            <p-button
                                styleClass="disabled:cursor-not-allowed"
                                icon="pi pi-print"
                                label="Print Selected"
                                [disabled]="
                                    !selectedDatas || selectedDatas.length === 0
                                "
                                (click)="printMultipleSelected()"
                                severity="info"
                            />
                            <p-button
                                label="Clear Filter"
                                [outlined]="true"
                                icon="pi pi-filter-slash"
                                (click)="clear(dt1)"
                            />
                            <p-button
                                icon="pi pi-external-link"
                                label="Export"
                                (click)="exportExcel(dt1)"
                            />
                            <p-iconfield iconPosition="left" class="ml-auto">
                                <p-inputicon>
                                    <i class="pi pi-search"></i>
                                </p-inputicon>
                                <input
                                    pInputText
                                    type="text"
                                    (input)="
                                        dt1.filterGlobal(
                                            $event.target.value,
                                            'contains'
                                        )
                                    "
                                    placeholder="Search keyword"
                                />
                            </p-iconfield>
                        </div>
                    </div>
                </ng-template>
                <ng-template #header let-columns>
                    <tr>
                        <th style="width: 3rem" pFrozenColumn>
                            <p-tableHeaderCheckbox
                                [value]="rowData"
                            ></p-tableHeaderCheckbox>
                        </th>
                        <th style="width: 3rem" pFrozenColumn>Action</th>
                        <th
                            *ngFor="let col of columns"
                            [pSortableColumn]="col.sortable ? col.field : null"
                        >
                            <div class="flex items-center justify-between">
                                {{ col.header.toUpperCase() }}
                                <div
                                    class="flex items-center justify-between ml-4"
                                >
                                    <ng-container *ngIf="col.sortable" class="">
                                        <p-sortIcon
                                            [field]="col.field"
                                        ></p-sortIcon>
                                        <p-columnFilter
                                            [type]="col.filterType || 'text'"
                                            [field]="col.field"
                                            [showOperator]="false"
                                            [showAddButton]="false"
                                            [matchMode]="
                                                col.filterType === 'select'
                                                    ? 'in'
                                                    : 'equals'
                                            "
                                            display="menu"
                                        >
                                            @if (col.filterType === 'select') {
                                                <ng-template
                                                    #filter
                                                    let-value
                                                    let-filter="filterCallback"
                                                >
                                                    <p-multiselect
                                                        [(ngModel)]="value"
                                                        [options]="
                                                            this[
                                                                col.field +
                                                                    'Data'
                                                            ]
                                                        "
                                                        placeholder="Select {{
                                                            col.header
                                                        }}"
                                                        (onChange)="
                                                            filter($event.value)
                                                        "
                                                        optionLabel="label"
                                                        style="min-width: 10rem"
                                                        [panelStyle]="{
                                                            minWidth: '10rem',
                                                        }"
                                                    >
                                                        <ng-template
                                                            let-option
                                                            #item
                                                        >
                                                            <div
                                                                class="flex items-center gap-2"
                                                            >
                                                                <span>{{
                                                                    option.label
                                                                }}</span>
                                                            </div>
                                                        </ng-template>
                                                    </p-multiselect>
                                                </ng-template>
                                            }
                                        </p-columnFilter>
                                    </ng-container>
                                </div>
                            </div>
                        </th>
                    </tr>
                </ng-template>
                <ng-template #body let-datas let-rowIndex="rowIndex">
                    <tr
                        [pSelectableRow]="datas"
                        [pSelectableRowIndex]="rowIndex"
                    >
                        <td pFrozenColumn>
                            <p-tableCheckbox [value]="datas" />
                        </td>
                        <td class="p-0 text-center" pFrozenColumn>
                            <div
                                class="flex items-center justify-center gap-2 p-0 mx-2"
                            >
                                <p-button
                                    size="small"
                                    icon="pi pi-print"
                                    (click)="printSelected(datas)"
                                    severity="info"
                                    pTooltip="Print this row"
                                    tooltipPosition="top"
                                />
                                <p-button
                                    size="small"
                                    icon="pi pi-pen-to-square"
                                    (click)="openDialog('Update', datas)"
                                    severity="success"
                                    pTooltip="Edit this row"
                                    tooltipPosition="top"
                                />
                            </div>
                        </td>

                        <td class="text-center">{{ datas.id }}</td>
                        <td>{{ datas.name }}</td>
                        <td>{{ datas.divisi }}</td>
                        <td>{{ datas.department }}</td>
                        <td class="text-center">{{ datas.plant }}</td>
                        <td class="text-center">
                            <p-tag
                                class="px-2 py-0"
                                [value]="datas.status"
                                [severity]="displayLabel(datas.status)"
                            />
                        </td>
                        <td class="text-center">
                            <p-tag
                                class="px-2 py-0"
                                [value]="datas.terminated"
                                [severity]="displayLabel(datas.terminated)"
                            />
                        </td>
                        <td class="text-center">
                            <p-tag
                                class="px-2 py-0"
                                [value]="datas.gender"
                                [severity]="displayLabel(datas.gender)"
                            />
                        </td>
                        <td class="text-center">{{ datas.family_stats }}</td>
                        <td>{{ datas.no_wa }}</td>
                        <td class="text-center">{{ datas.souvenir }}</td>
                        <td>
                            <p-tag
                                class="px-2 py-0"
                                [value]="displayText(datas.scan)"
                                [severity]="displayLabel(datas.scan)"
                            />
                        </td>
                        <td>
                            {{
                                datas.scan_date !== '01-01-1970 07:00:00'
                                    ? datas.scan_date
                                    : ''
                            }}
                        </td>
                        <td>{{ datas.kaos_employee1 }}</td>
                        <td>{{ datas.kaos_spouse1 }}</td>
                        <td>
                            <p-tag
                                class="px-2 py-0"
                                [value]="datas.dlong"
                                severity="info"
                            />
                        </td>
                        <td>
                            <p-tag
                                class="px-2 py-0"
                                [value]="datas.dshort"
                                severity="warn"
                            />
                        </td>
                        <td>{{ datas.kaos_child1 }}</td>
                        <td>{{ datas.kaos_child2 }}</td>
                        <td>{{ datas.kaos_child3 }}</td>
                        <td>{{ datas.kaos_child4 }}</td>
                        <td>{{ datas.kaos_child5 }}</td>
                        <td>{{ datas.kaos_child6 }}</td>
                        <td>
                            <p-tag
                                class="px-2 py-0"
                                [value]="datas.clong"
                                severity="info"
                            />
                        </td>
                        <td>
                            <p-tag
                                class="px-2 py-0"
                                [value]="datas.cshort"
                                severity="warn"
                            />
                        </td>
                    </tr>
                </ng-template>

                <ng-template pTemplate="paginatorleft">
                    <span
                        >✅ Selected
                        {{ selectedDatas?.length || 0 }} records</span
                    >
                </ng-template>

                <ng-template pTemplate="paginatorright">
                    <span
                        >📄 Showing {{ dt1.first + 1 }} to
                        {{ dt1.first + dt1.rows }} of
                        {{ dt1.totalRecords }} entries</span
                    >
                </ng-template>
            </p-table>
        </div>
    </div>
</div>
<app-print-label id="print-section" [datas]="this.data"></app-print-label>
